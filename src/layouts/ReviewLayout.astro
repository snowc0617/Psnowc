---
// src/layouts/ReviewLayout.astro
import BaseLayout from './BaseLayout.astro';
import RelatedPosts from '../components/RelatedPosts.astro';

const { frontmatter, url } = Astro.props; 

// 1. æº–å‚™çµ¦ Google çœ‹çš„çµæ§‹åŒ–è³‡æ–™ (JSON-LD)
const schemaData = {
  "@context": "https://schema.org/",
  "@type": "Review",
  "itemReviewed": {
    "@type": "Game",
    "name": frontmatter.itemName || frontmatter.title 
  },
  "reviewRating": {
    "@type": "Rating",
    "ratingValue": frontmatter.rating,
    "bestRating": "10",
    "worstRating": "1"
  },
  "author": {
    "@type": "Person",
    "name": frontmatter.author || "Snowc"
  },
  "publisher": {
    "@type": "Organization",
    "name": "SnowcNEWS"
  }
};

// 2. æº–å‚™çµ¦äººçœ‹çš„æ˜Ÿæ˜Ÿé¡¯ç¤ºé‚è¼¯
const ratingPercentage = (frontmatter.rating / 10) * 100;

// 3. å‹•æ…‹è¨ˆç®—åœˆåœˆé¡è‰²
let circleColor = '#ef233c';     
let circleTextColor = '#ffffff'; 

if (frontmatter.rating >= 8.5) {
  circleColor = '#ffd700';       
  circleTextColor = '#2b2d42';   
} else if (frontmatter.rating > 5) {
  circleColor = '#10b981';       
}
---

<BaseLayout pageTitle={`[è©•æ¸¬] ${frontmatter.title}`} frontmatter={frontmatter}>
  
  <script type="application/ld+json" set:html={JSON.stringify(schemaData)} />

  <article class="review-article">
    
    {/* è©•åˆ†å¡ç‰‡å€å¡Š */}
    <div class="score-card">
      <div 
        class="score-circle" 
        style={`background-color: ${circleColor}; color: ${circleTextColor};`}
      >
        <span class="score-number">{frontmatter.rating}</span>
        <span class="score-max">/10</span>
      </div>
      
      <div class="score-info">
        <h1>{frontmatter.title}</h1>
        
        {/* â˜…â˜…â˜… æ–°å¢ï¼šæ—¥æœŸèˆ‡ä½œè€…è³‡è¨Š â˜…â˜…â˜… */}
        <div class="review-meta">
          <span class="meta-item">
            ğŸ“… {new Date(frontmatter.pubDate).toLocaleDateString('zh-TW')}
          </span>
          <span class="meta-item">
            ğŸ‘¤ {frontmatter.author || "Snowc"}
          </span>
        </div>

        {frontmatter.itemName && (
          <p class="reviewed-item">è©•æ¸¬å°è±¡ï¼š{frontmatter.itemName}</p>
        )}
        
        <div class="star-container">
          <div class="stars-bg">â˜…â˜…â˜…â˜…â˜…</div>
          <div class="stars-fill" style={`width: ${ratingPercentage}%`}>â˜…â˜…â˜…â˜…â˜…</div>
        </div>
      </div>
    </div>

    {/* æ–‡ç« å…§å®¹ */}
    <div class="review-content">
      <slot />

      <RelatedPosts 
        currentTags={frontmatter.tags || []} 
        currentUrl={url} 
      />
    </div>

  </article>
</BaseLayout>

<style>
  .score-card {
    background: linear-gradient(135deg, #2b2d42, #1a1b26);
    color: white;
    padding: 2rem;
    border-radius: 1rem;
    display: flex;
    align-items: center;
    gap: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
  }

  .score-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    border: 4px solid rgba(255,255,255,0.2);
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    transition: all 0.3s ease;
  }

  .score-number { font-size: 2.5rem; font-weight: 800; line-height: 1; }
  .score-max { font-size: 0.8rem; opacity: 0.8; }

  .score-info { flex-grow: 1; }
  .score-info h1 { margin: 0 0 0.5rem 0; font-size: 1.8rem; color: white; line-height: 1.3; }
  
  /* â˜…â˜…â˜… æ–°å¢æ¨£å¼ï¼šæ—¥æœŸèˆ‡ä½œè€… â˜…â˜…â˜… */
  .review-meta {
    display: flex;
    gap: 1rem;
    margin-bottom: 0.8rem;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8); /* åŠé€æ˜ç™½è‰²ï¼Œç¢ºä¿åœ¨æ·±è‰²èƒŒæ™¯å¯è®€ */
  }
  
  .meta-item {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
  }

  .reviewed-item { margin: 0 0 1rem 0; color: #aaa; font-size: 0.9rem; }

  .star-container {
    position: relative;
    display: inline-block;
    font-size: 1.5rem;
    line-height: 1;
  }
  .stars-bg { color: #555; }
  .stars-fill {
    color: #ffd700;
    position: absolute;
    top: 0;
    left: 0;
    overflow: hidden;
    white-space: nowrap;
  }

  .review-content {
    background: white;
    padding: 2rem;
    border-radius: 1rem;
    line-height: 1.8;
    color: #333;
  }

  @media (max-width: 600px) {
    .score-card { flex-direction: column; text-align: center; }
    /* æ‰‹æ©Ÿç‰ˆè®“ meta è³‡è¨Šç½®ä¸­ */
    .review-meta { justify-content: center; }
  }
</style>