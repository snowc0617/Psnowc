---
// src/components/AgeGate.astro
---

<div id="age-gate" class="age-gate-overlay" style="display: none;">
  <div class="age-gate-box">
    <div class="warning-icon">ğŸ”</div>
    <h2>æœªæ»¿ 18 æ­²ç¦æ­¢é€²å…¥</h2>
    <p>
      æœ¬ç«™åŒ…å«æˆäººå…§å®¹ (R-18)ã€‚<br>
      å¦‚æœæ‚¨æœªæ»¿ 18 æ­²ï¼Œæˆ–æ‚¨ç•¶åœ°çš„æ³•å¾‹ç¦æ­¢ç€è¦½æ­¤é¡å…§å®¹ï¼Œè«‹ç«‹å³é›¢é–‹ã€‚
    </p>
    <div class="gate-buttons">
      <a href="https://www.google.com" class="btn btn-leave">é›¢é–‹</a>
      <button id="enter-btn" class="btn btn-enter">æˆ‘å·²æ»¿ 18 æ­²ï¼Œé€²å…¥</button>
    </div>
  </div>
</div>

<script>
  // æª¢æŸ¥ç€è¦½å™¨æ˜¯å¦å·²é©—è­‰
  const checkAge = () => {
    const isVerified = localStorage.getItem('snowc_age_verified');
    const ageGate = document.getElementById('age-gate');
    
    if (isVerified !== 'true') {
      // æ²’é©—è­‰éï¼šé¡¯ç¤ºå½ˆçª—ï¼Œä¸¦é–å®šæ»¾å‹•
      if (ageGate) ageGate.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    } else {
      // å·²é©—è­‰éï¼šç¢ºä¿éš±è—
      if (ageGate) ageGate.style.display = 'none';
      document.body.style.overflow = 'auto';
    }
  };

  // åˆå§‹åŒ–æª¢æŸ¥
  checkAge();

  // è™•ç† View Transitions (å¦‚æœæœ‰ç”¨çš„è©±ï¼Œæ›é ä¹Ÿè¦æª¢æŸ¥)
  document.addEventListener('astro:page-load', checkAge);

  // ç¶å®šæŒ‰éˆ•äº‹ä»¶
  const enterBtn = document.getElementById('enter-btn');
  const ageGate = document.getElementById('age-gate');

  if (enterBtn && ageGate) {
    enterBtn.addEventListener('click', () => {
      // è¨­å®šé©—è­‰ç‹€æ…‹
      localStorage.setItem('snowc_age_verified', 'true');
      
      // å‹•ç•«éš±è—
      ageGate.style.opacity = '0';
      document.body.style.overflow = 'auto'; // æ¢å¾©æ»¾å‹•
      
      setTimeout(() => {
        ageGate.style.display = 'none';
      }, 500);
    });
  }
</script>

<style>
  .age-gate-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.95);
    backdrop-filter: blur(10px);
    z-index: 99999; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s;
  }

  .age-gate-box {
    background: #1a1a1a;
    padding: 3rem;
    border-radius: 1rem;
    text-align: center;
    max-width: 500px;
    width: 90%;
    border: 1px solid #333;
    box-shadow: 0 0 30px rgba(236, 72, 153, 0.2);
  }

  .warning-icon { font-size: 4rem; margin-bottom: 1rem; }
  
  .age-gate-box h2 { 
    color: #ec4899;
    font-size: 2rem; 
    margin-bottom: 1rem; 
  }
  
  .age-gate-box p { 
    color: #ccc; 
    line-height: 1.6; 
    margin-bottom: 2rem; 
  }

  .gate-buttons { display: flex; gap: 1rem; justify-content: center; }
  
  .btn-enter {
    background: #ec4899;
    color: white;
    border: none;
    cursor: pointer;
    padding: 0.8rem 1.5rem;
    border-radius: 999px;
    font-weight: bold;
    font-size: 1rem;
  }
  .btn-enter:hover { background: #db2777; }
  
  .btn-leave {
    background: #333;
    color: white;
    padding: 0.8rem 1.5rem;
    border-radius: 999px;
    text-decoration: none;
    font-weight: bold;
    font-size: 1rem;
  }
  .btn-leave:hover { background: #444; }
</style>